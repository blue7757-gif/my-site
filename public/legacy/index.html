<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EST-Sample - 내신기출문제</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
  <!-- Header -->
  <header class="border-b bg-white">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between gap-4">
      <a href="home.html" class="flex items-center gap-2 select-none" aria-label="홈으로">
        <svg viewBox="0 0 100 100" class="h-7 w-7" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#f43f5e" />
              <stop offset="50%" stop-color="#fb923c" />
              <stop offset="100%" stop-color="#22d3ee" />
            </linearGradient>
          </defs>
          <polygon points="25,15 85,50 25,85" fill="url(#g)" />
        </svg>
        <span class="text-2xl font-bold tracking-tight">EST-Sample</span>
      </a>

      <form class="flex items-center gap-2 w-full max-w-md" onsubmit="event.preventDefault();">
        <label class="sr-only" for="top-q">검색어</label>
        <input id="top-q" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-4 focus:ring-sky-100" placeholder="학교 검색" />
        <button class="rounded-xl bg-sky-600 px-4 py-2 whitespace-nowrap text-white shadow-sm hover:bg-sky-700" type="submit">검색</button>
      </form>

      <nav class="hidden md:flex items-center gap-4 text-sm text-slate-600" aria-label="보조 링크">
        <a class="hover:text-slate-900" href="#">로그인</a>
        <span class="text-slate-300">|</span>
        <a class="hover:text-slate-900" href="#">회원가입</a>
        <span class="text-slate-300">|</span>
        <a class="hover:text-slate-900" href="#">마이페이지</a>
      </nav>
    </div>

    <div class="border-t bg-gradient-to-r from-violet-600 via-sky-600 to-cyan-500">
      <div class="mx-auto max-w-6xl px-4">
        <ul id="primary-tabs" class="flex flex-wrap gap-2 py-3 text-sm text-white" role="tablist">
          <li><a href="index.html" class="rounded-xl px-16 py-2 inline-block bg-white/20 ring-1 ring-white/40" aria-current="page">내신기출문제</a></li>
          <li><a href="middle.html" class="rounded-xl bg-white/10 px-16 py-2 inline-block text-center hover:bg-white/20">중등자료</a></li>
          <li><a href="high.html"   class="rounded-xl bg-white/10 px-16 py-2 inline-block text-center hover:bg-white/20">고등자료</a></li>
          <li><a href="mock.html"   class="rounded-xl bg-white/10 px-16 py-2 inline-block text-center hover:bg-white/20">모의고사</a></li>
          <li><a href="help.html"   class="rounded-xl bg-white/10 px-16 py-2 inline-block hover:bg-white/20">이용안내·문의</a></li>
        </ul>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-6">
    <section class="flex flex-col gap-4">
      <div class="flex items-stretch gap-3">
        <div class="rounded-2xl border bg-white p-4 shadow-sm flex-1" id="filter-card">
          <!-- Row 1 -->
          <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 items-center">
            <select id="si" class="rounded-xl border px-2 py-2 text-sm">
              <option value="">시/도</option>
            </select>
            <select id="gu" class="rounded-xl border px-2 py-2 text-sm" disabled>
              <option value="">구/군</option>
            </select>
            <select id="level" class="rounded-xl border px-4 py-2 text-sm min-w-0">
              <option value="">중/고등학교</option>
              <option value="중학교">중학교</option>
              <option value="고등학교">고등학교</option>
            </select>

            <!-- 학교 이름 (NEIS로 채움) -->
            <select id="school" class="rounded-xl border px-4 py-2 text-sm" disabled>
              <option value="">학교 이름</option>
            </select>

            <select id="grade" class="rounded-xl border px-2 py-2 text-sm">
              <option value="">학년</option>
              <option value="1">1학년</option>
              <option value="2">2학년</option>
              <option value="3">3학년</option>
            </select>
            <div class="flex items-center gap-2 w-full">
              <button id="searchBtnTop" class="shrink-0 w-full h-10 rounded-xl bg-sky-600 text-white shadow-sm hover:bg-sky-700">검색</button>
            </div>
          </div>

          <!-- Row 2 -->
          <div class="mt-3 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 items-center">
            <select id="year" class="rounded-xl border px-2 py-2 text-sm">
              <option value="">기출년도</option>
            </select>
            <select id="exam" class="rounded-xl border px-2 py-2 text-sm">
              <option value="">중간/기말</option>
              <option value="중간">중간</option>
              <option value="기말">기말</option>
            </select>
            <input id="keyword" class="rounded-xl border px-3 py-2 text-sm lg:col-span-2" placeholder="학교, 과목, 닉네임, 출판사로 검색" />
            <label class="inline-flex items-center gap-1 text-sm">
              <input id="need-solution" type="checkbox" class="h-4 w-4 rounded border-slate-300" />
              <span>해설</span>
            </label>
            <button id="uploadBtn" class="h-10 rounded-xl bg-sky-600 text-white shadow-sm hover:bg-sky-700 whitespace-nowrap lg:col-span-1">기출 올리기</button>
          </div>

          <div class="mt-3 text-xs text-slate-500 leading-6">
            <p><span class="text-rose-500">①</span> <span class="font-medium">경제</span>로 검색하면 경제 수학이 검색됩니다.</p>
            <p><span class="text-rose-500">②</span> <span class="font-medium">과제</span>로 검색하시면 수학과제탐구가 검색됩니다.</p>
          </div>
        </div>
      </div>

      <!-- Results list -->
      <div class="rounded-2xl border bg-white shadow-sm overflow-hidden">
        <div class="border-b bg-slate-50 px-4 py-3 text-sm font-semibold">
          <span id="result-title">검색 결과</span>
          <span id="result-count" class="text-slate-400 font-normal"></span>
        </div>
        <div id="results" class="divide-y"></div>
      </div>
    </section>
  </main>

  <footer class="mt-10 border-t bg-white">
    <div class="mx-auto max-w-6xl px-4 py-8 text-xs text-slate-500">© 2025 EST-Sample. All rights reserved.</div>
  </footer>

<script>
  /* --------- NEIS API 설정 --------- */
  const NEIS_KEY = ''; // ← 여기 본인 인증키 입력 (비워두면 sample key로 5건만 반환)
  const NEIS_BASE = 'https://open.neis.go.kr/hub/schoolInfo'; // 학교기본정보 API :contentReference[oaicite:1]{index=1}

  // 시/도 → 교육청 코드(ATPT_OFCDC_SC_CODE)
  const ATPT_CODE = {
    "서울":"B10","부산":"C10","대구":"D10","인천":"E10","광주":"F10","대전":"G10","울산":"H10",
    "세종":"I10","경기":"J10","강원":"K10","충북":"M10","충남":"N10","전북":"P10","전남":"Q10",
    "경북":"R10","경남":"S10","제주":"T10"
  }; // 값 예: B10=서울특별시교육청 응답 예시 참고 :contentReference[oaicite:2]{index=2}

  /* --------- 시/도 / 구·군 목록 --------- */
  const SI_OPTIONS = [
    "서울","세종","광주","대구","대전","부산","인천","울산",
    "경기","강원","충남","충북","경남","경북","전남","전북","제주","기타"
  ];
  const GUGUN_MAP = {
    "서울":[ "강남구","강동구","강북구","강서구","관악구","광진구","구로구","금천구","노원구","도봉구",
      "동대문구","동작구","마포구","서대문구","서초구","성동구","성북구","송파구","양천구","영등포구",
      "용산구","은평구","종로구","중구","중랑구" ],
    "부산":[ "중구","서구","동구","영도구","부산진구","동래구","남구","북구","해운대구","사하구",
      "금정구","강서구","연제구","수영구","사상구","기장군" ],
    "대구":[ "중구","동구","서구","남구","북구","수성구","달서구","달성군" ],
    "인천":[ "중구","동구","미추홀구","연수구","남동구","부평구","계양구","서구","강화군","옹진군" ],
    "광주":[ "동구","서구","남구","북구","광산구" ],
    "대전":[ "동구","중구","서구","유성구","대덕구" ],
    "울산":[ "중구","남구","동구","북구","울주군" ],
    "세종":[ "세종시" ],
    "경기":[ "수원시","성남시","의정부시","안양시","부천시","광명시","평택시","동두천시","안산시","고양시",
      "과천시","구리시","남양주시","용인시","시흥시","군포시","의왕시","하남시","오산시","파주시",
      "이천시","안성시","김포시","화성시","광주시","양주시","포천시","여주시","연천군","가평군","양평군" ],
    "강원":[ "춘천시","원주시","강릉시","동해시","태백시","속초시","삼척시","홍천군","횡성군","영월군",
      "평창군","정선군","철원군","화천군","양구군","인제군","고성군","양양군" ],
    "충남":[ "천안시","공주시","보령시","아산시","서산시","논산시","계룡시","당진시",
      "금산군","부여군","서천군","청양군","홍성군","예산군","태안군" ],
    "충북":[ "청주시","충주시","제천시","보은군","옥천군","영동군","증평군","진천군","괴산군","음성군","단양군" ],
    "경남":[ "창원시","진주시","통영시","사천시","김해시","밀양시","거제시","양산시",
      "의령군","함안군","창녕군","고성군","남해군","하동군","산청군","함양군","거창군","합천군" ],
    "경북":[ "포항시","경주시","김천시","안동시","구미시","영주시","영천시","상주시","문경시","경산시",
      "군위군","의성군","청송군","영양군","영덕군","청도군","고령군","성주군","칠곡군","예천군","봉화군","울진군","울릉군" ],
    "전남":[ "목포시","여수시","순천시","나주시","광양시","담양군","곡성군","구례군","고흥군","보성군",
      "화순군","장흥군","강진군","해남군","영암군","무안군","함평군","영광군","장성군","완도군","진도군","신안군" ],
    "전북":[ "전주시","군산시","익산시","정읍시","남원시","김제시","완주군","진안군","무주군","장수군",
      "임실군","순창군","고창군","부안군" ],
    "제주":[ "제주시","서귀포시" ],
    "기타":[ "기타" ]
  };

  /* --------- 샘플 결과 데이터(리스트 렌더링용) --------- */
  const DATA = [
    { id: 1, schoolName: "원화중학교", si: "인천", gu: "남동구", level: "중학교", grade: 1, year: 2022, exam: "기말", unit: "중1-1", type: "모두의수학", hasSolution: true, hasVideo: false, subject: "수학", nick: "upsup", publisher: "모두의수학" },
    { id: 2, schoolName: "신명여자중학교", si: "서울", gu: "강남구", level: "중학교", grade: 1, year: 2023, exam: "기말", unit: "중1-1", type: "모두의수학", hasSolution: true, hasVideo: true, subject: "수학", nick: "mstudy", publisher: "모두의수학" },
    { id: 3, schoolName: "관교중학교", si: "인천", gu: "남동구", level: "중학교", grade: 1, year: 2024, exam: "기말", unit: "중1-2", type: "upsup", hasSolution: false, hasVideo: false, subject: "수학", nick: "upsup", publisher: "업섭" },
    { id: 4, schoolName: "울산중학교", si: "울산", gu: "남구", level: "중학교", grade: 2, year: 2024, exam: "기말", unit: "중2-2", type: "공통", hasSolution: true, hasVideo: false, subject: "수학", nick: "hsis0425", publisher: "공통" },
    { id: 5, schoolName: "상북중학교", si: "울산", gu: "중구", level: "중학교", grade: 2, year: 2024, exam: "기말", unit: "중2-2", type: "—", hasSolution: false, hasVideo: false, subject: "수학", nick: "teacherK", publisher: "—" },
    { id: 6, schoolName: "경덕사범대부설중", si: "경기", gu: "수원시", level: "중학교", grade: 2, year: 2024, exam: "기말", unit: "중2-2", type: "—", hasSolution: false, hasVideo: true, subject: "수학", nick: "덕수", publisher: "—" },
    { id: 7, schoolName: "법일중학교", si: "부산", gu: "해운대구", level: "중학교", grade: 2, year: 2024, exam: "기말", unit: "중2-2", type: "—", hasSolution: true, hasVideo: true, subject: "수학", nick: "법중", publisher: "—" },
    { id: 8, schoolName: "구월중학교", si: "인천", gu: "남동구", level: "중학교", grade: 2, year: 2024, exam: "기말", unit: "중2-2", type: "—", hasSolution: false, hasVideo: false, subject: "수학", nick: "구월", publisher: "—" },
    { id: 9, schoolName: "충남외국어고등학교", si: "충남", gu: "천안시", level: "고등학교", grade: 2, year: 2025, exam: "중간", unit: "공통(통합)", type: "공통", hasSolution: true, hasVideo: false, subject: "수학", nick: "nowmath", publisher: "—" },
  ];

  /* --------- DOM --------- */
  const el = id => document.getElementById(id);
  const siSel = el('si'), guSel = el('gu'), levelSel = el('level'), schoolSel = el('school');
  const gradeSel = el('grade'), yearSel = el('year'), examSel = el('exam'), needSolution = el('need-solution');
  const keyword = el('keyword'), results = el('results'), resultCount = el('result-count');

  /* --------- 초기 옵션 --------- */
  function initOptions() {
    siSel.innerHTML = ''; siSel.append(new Option('시/도',''));
    SI_OPTIONS.forEach(s => siSel.append(new Option(s, s)));
    yearSel.innerHTML=''; yearSel.append(new Option('기출년도',''));
    [...new Set(DATA.map(d => d.year))].sort((a,b)=>b-a).forEach(y => yearSel.append(new Option(y, y)));
    fillGu();
    resetSchoolSelect('학교 이름');
  }
  function fillGu() {
    const si = siSel.value;
    guSel.innerHTML=''; guSel.append(new Option('구/군',''));
    const list = GUGUN_MAP[si] || [];
    if (si && list.length) { list.forEach(g => guSel.append(new Option(g, g))); guSel.disabled = false; }
    else { guSel.disabled = true; }
  }
  function resetSchoolSelect(placeholder='학교 이름') {
    schoolSel.innerHTML = ''; schoolSel.append(new Option(placeholder,''));
    schoolSel.disabled = true;
  }

  /* --------- NEIS 조회 + 채우기 --------- */
  const SCHOOL_CACHE = new Map(); // key: si|gu|level -> string[]

  async function fetchNeisSchools(si, gu, level) {
    const cacheKey = `${si}|${gu}|${level||''}`;
    if (SCHOOL_CACHE.has(cacheKey)) return SCHOOL_CACHE.get(cacheKey);

    const atpt = ATPT_CODE[si];
    if (!atpt) { SCHOOL_CACHE.set(cacheKey, []); return []; }

    const params = new URLSearchParams({
      KEY: NEIS_KEY || 'sample', Type: 'json', pIndex: '1', pSize: '1000',
      ATPT_OFCDC_SC_CODE: atpt
    });
    if (level) params.append('SCHUL_KND_SC_NM', level); // 초/중/고 종류 필터 :contentReference[oaicite:3]{index=3}

    const url = `${NEIS_BASE}?${params}`;
    let list = [];
    try {
      const res = await fetch(url, { method: 'GET' });
      const data = await res.json();
      // 응답 구조: { schoolInfo: [ { head: [...] }, { row: [...] } ] } 형태 :contentReference[oaicite:4]{index=4}
      const rows = data?.schoolInfo?.find?.(x => Array.isArray(x.row))?.row || data?.schoolInfo?.[1]?.row || [];
      // 주소(ORG_RDNMA / JU_ORG_NM 등)에 구/군 문자열 포함 여부로 필터
      const GU = (gu || '').trim();
      list = rows.filter(r => {
        if (!GU) return true;
        const addr = `${r.ORG_RDNMA||''} ${r.JU_ORG_NM||''} ${r.ORG_RDNDA||''} ${r.LCTN_SC_NM||''}`;
        return addr.includes(GU);
      }).map(r => r.SCHUL_NM);

      // 유니크 + 정렬
      list = [...new Set(list)].sort((a,b)=>a.localeCompare(b,'ko'));
    } catch (e) {
      console.error('NEIS fetch error:', e);
      list = [];
    }
    SCHOOL_CACHE.set(cacheKey, list);
    return list;
  }

  async function loadSchoolOptions() {
    const si = siSel.value, gu = guSel.value, level = levelSel.value;
    if (!si || !gu) { resetSchoolSelect('학교 이름'); return; }

    resetSchoolSelect('학교 이름 (로딩중…)');
    const names = await fetchNeisSchools(si, gu, level);

    schoolSel.innerHTML = '';
    schoolSel.append(new Option('학교 이름',''));
    names.forEach(n => schoolSel.append(new Option(n, n)));
    schoolSel.disabled = names.length === 0;
    if (!names.length) schoolSel.options[0].text = '학교 이름 (없음)';
  }

  /* --------- 렌더링 --------- */
  function render(list) {
    results.innerHTML = '';
    resultCount.textContent = `(${list.length}건)`;
    if (!list.length) {
      const empty = document.createElement('div');
      empty.className = 'px-4 py-8 text-sm text-slate-500';
      empty.textContent = '검색 결과가 없습니다.';
      results.append(empty);
      return;
    }
    for (const row of list) {
      const a = document.createElement('a');
      a.href = '#';
      a.className = 'flex items-center gap-3 px-4 py-3 hover:bg-sky-50 focus:bg-sky-50';
      a.innerHTML = `
        <div class="flex-1 min-w-0">
          <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-sm">
            <span class="font-medium text-slate-900">${row.schoolName}</span>
            <span class="text-slate-400">|</span>
            <span>${row.grade}학년</span>
            <span class="text-slate-400">|</span>
            <span>${row.year}년</span>
            <span class="text-slate-400">|</span>
            <span>${row.exam === '중간' ? '2학기중간' : '2학기기말'}</span>
            <span class="text-slate-400">|</span>
            <span class="truncate">${row.unit}</span>
          </div>
          <p class="mt-1 text-xs text-slate-500">유형: ${row.type}${row.hasSolution ? ' · 해설' : ''}${row.hasVideo ? ' · 동영상' : ''}</p>
        </div>
        <div class="shrink-0 rounded-full ${row.hasVideo ? 'bg-emerald-100 text-emerald-700 border-emerald-200' : 'bg-amber-100 text-amber-700 border-amber-200'} px-2 py-0.5 text-[11px] border">${row.hasVideo ? 'V' : 'N'}</div>
      `;
      results.append(a);
    }
  }

  /* --------- 필터 --------- */
  function applyFilters() {
    const kw = keyword.value.trim().toLowerCase();
    const topKw = document.getElementById('top-q').value.trim().toLowerCase();
    const allKw = kw || topKw;

    const list = DATA.filter(row => {
      if (siSel.value && row.si !== siSel.value) return false;
      if (!guSel.disabled && guSel.value && row.gu !== guSel.value) return false;
      if (levelSel.value && row.level !== levelSel.value) return false;
      if (schoolSel.value && row.schoolName !== schoolSel.value) return false; // 학교 필터
      if (gradeSel.value && String(row.grade) !== gradeSel.value) return false;
      if (yearSel.value && String(row.year) !== yearSel.value) return false;
      if (examSel.value && row.exam !== examSel.value) return false;
      if (needSolution.checked && !row.hasSolution) return false;

      if (allKw) {
        const hay = `${row.schoolName} ${row.subject} ${row.nick} ${row.publisher}`.toLowerCase();
        if (!hay.includes(allKw)) return false;
      }
      return true;
    });
    render(list);
  }

  /* --------- 이벤트 --------- */
  document.getElementById('searchBtnTop').addEventListener('click', applyFilters);
  document.getElementById('top-q').addEventListener('keydown', e => {
    if (e.key === 'Enter') { e.preventDefault(); applyFilters(); }
  });
  document.getElementById('keyword').addEventListener('keydown', e => {
    if (e.key === 'Enter') { e.preventDefault(); applyFilters(); }
  });

  siSel.addEventListener('change', () => { fillGu(); loadSchoolOptions(); });
  guSel.addEventListener('change', loadSchoolOptions);
  levelSel.addEventListener('change', loadSchoolOptions);
  schoolSel.addEventListener('change', applyFilters);

  /* --------- 시작 --------- */
  initOptions();
  render(DATA);
</script>
</body>
</html>
